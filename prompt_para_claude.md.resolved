MONGO enviroments....

You need to secure your MongoDB Atlas cluster before you can use it. Set which users and IP addresses can access your cluster now. Read more 

Add a connection IP address
Your current IP address (93.156.194.248) has been added to enable local connectivity. Only an IP address you add to your Access List will be able to connect to your project's clusters. Add more later in Network Access.
Create a database user
This first user will have atlasAdmin  permissions for this project.

We autogenerated a username and password. You can use this or create your own.

You'll need your database user's credentials in the next step. Copy the database user password.
Username
lucasriestra94_db_user
Password
cyXulr0HCzhaxQBD
Hide

1. Select your driver and version
We recommend installing and using the latest driver version.

Driver

Version

2. Install your driver
Run the following on the command line
dotnet add package MongoDB.Driver

View MongoDB C# / .NET Driver installation instructions.
3. Add your connection string into your application code
Use this connection string in your application


View full code sample


Show Password

mongodb+srv://lucasriestra94_db_user:cyXulr0HCzhaxQBD@cluster0.4qnynkc.mongodb.net/?appName=Cluster0

The password for lucasriestra94_db_user is included in the connection string for your first time setup. This password will not be available again after exiting this connect flow.


using MongoDB.Driver;
using MongoDB.Bson;

const string connectionUri = "mongodb+srv://lucasriestra94_db_user:cyXulr0HCzhaxQBD@cluster0.4qnynkc.mongodb.net/?appName=Cluster0";

var settings = MongoClientSettings.FromConnectionString(connectionUri);

// Set the ServerApi field of the settings object to set the version of the Stable API on the client
settings.ServerApi = new ServerApi(ServerApiVersion.V1);

// Create a new client and connect to the server
var client = new MongoClient(settings);

// Send a ping to confirm a successful connection
try {
  var result = client.GetDatabase("admin").RunCommand<BsonDocument>(new BsonDocument("ping", 1));
  Console.WriteLine("Pinged your deployment. You successfully connected to MongoDB!");
} catch (Exception ex) {
  Console.WriteLine(ex);
}


# üéØ Prompt para Claude: Completar FreshStock API

## üìã Contexto del Proyecto

**FreshStock** es una API REST para gesti√≥n de inventario de restaurantes desarrollada con **ASP.NET Core 8** y **PostgreSQL**. El proyecto est√° funcional pero incompleto (~33% de features planificadas).

### Repositorio
- **GitHub**: https://github.com/LucasRiestra/FreshStock
- **Tecnolog√≠as**: ASP.NET Core 8, Entity Framework Core 9, PostgreSQL, AutoMapper
- **Arquitectura**: Capas (Controllers ‚Üí Services ‚Üí DbContext)

---

## ‚úÖ Estado Actual (Lo que YA funciona)

### Entidades Implementadas (100%)
- ‚úÖ Restaurante (CRUD + soft delete)
- ‚úÖ Usuario (CRUD + soft delete) - ‚ö†Ô∏è **Password SIN hash**
- ‚úÖ Categor√≠a (CRUD)
- ‚úÖ Proveedor (CRUD + soft delete)
- ‚úÖ Producto (CRUD + creaci√≥n masiva bulk)
- ‚úÖ StockLocal (gesti√≥n por lotes con fechas de caducidad)
- ‚úÖ MovimientoInventario (entradas, salidas, mermas, transferencias, reversi√≥n)

### Features Funcionales
- ‚úÖ Gesti√≥n multi-restaurante
- ‚úÖ Control de stock en tiempo real
- ‚úÖ Trazabilidad completa por lotes
- ‚úÖ Sistema de mermas con endpoint dedicado
- ‚úÖ Reversi√≥n de movimientos sin perder historial
- ‚úÖ Transferencias entre restaurantes
- ‚úÖ Validaciones de negocio (stock disponible, lotes √∫nicos)
- ‚úÖ Transacciones para integridad de datos
- ‚úÖ Creaci√≥n masiva de productos (bulk endpoint)

### Estructura del Proyecto
```
FreshStock.API/
‚îú‚îÄ‚îÄ Controllers/         (7 controladores)
‚îú‚îÄ‚îÄ Services/            (7 servicios)
‚îú‚îÄ‚îÄ Interfaces/          (7 interfaces)
‚îú‚îÄ‚îÄ DTOs/                (7 DTOs)
‚îú‚îÄ‚îÄ Entities/            (8 entidades)
‚îú‚îÄ‚îÄ Data/                (ApplicationDbContext)
‚îú‚îÄ‚îÄ Mappings/            (AutoMapper configurado)
‚îî‚îÄ‚îÄ Migrations/          (3 migraciones)
```

---

## ‚ùå Lo que FALTA Implementar (Priorizado)

### üî¥ PRIORIDAD CR√çTICA: Autenticaci√≥n JWT

**Problema actual**: 
- Passwords almacenados en texto plano en la entidad [Usuario](file:///c:/Users/lucas/Documents/GitHub/FreshStock/FreshStock.API/Entities/Usuario.cs#3-12)
- No hay endpoints de login/register
- API completamente abierta sin seguridad
- No hay middleware de autenticaci√≥n

**Requerimientos**:

1. **Instalar paquetes NuGet**:
   ```bash
   dotnet add package Microsoft.AspNetCore.Authentication.JwtBearer
   dotnet add package BCrypt.Net-Next
   dotnet add package System.IdentityModel.Tokens.Jwt
   ```

2. **Modificar entidad Usuario**:
   ```csharp
   // Cambiar de:
   public string Password { get; set; }
   
   // A:
   public string PasswordHash { get; set; }
   public string? RefreshToken { get; set; }
   public DateTime? RefreshTokenExpiry { get; set; }
   ```

3. **Crear DTOs de autenticaci√≥n**:
   ```csharp
   public class LoginRequestDTO
   {
       [Required, EmailAddress]
       public string Email { get; set; }
       
       [Required]
       public string Password { get; set; }
   }
   
   public class LoginResponseDTO
   {
       public string AccessToken { get; set; }
       public string RefreshToken { get; set; }
       public DateTime Expiration { get; set; }
       public UsuarioDTO Usuario { get; set; }
   }
   
   public class RegisterRequestDTO
   {
       [Required]
       public int RestauranteId { get; set; }
       
       [Required, StringLength(100)]
       public string Nombre { get; set; }
       
       [Required, EmailAddress]
       public string Email { get; set; }
       
       [Required, MinLength(8)]
       public string Password { get; set; }
       
       [Required]
       public string Rol { get; set; } // Admin, Gerente, Empleado
   }
   ```

4. **Crear servicio de autenticaci√≥n**:
   ```csharp
   public interface IAuthService
   {
       Task<LoginResponseDTO> LoginAsync(LoginRequestDTO request);
       Task<UsuarioDTO> RegisterAsync(RegisterRequestDTO request);
       Task<LoginResponseDTO> RefreshTokenAsync(string refreshToken);
       Task<bool> RevokeTokenAsync(string refreshToken);
   }
   ```

5. **Implementar generaci√≥n de JWT**:
   - Secret key en [appsettings.json](file:///c:/Users/lucas/Documents/GitHub/FreshStock/FreshStock.API/appsettings.json)
   - Claims: UserId, Email, Rol, RestauranteId
   - Expiration: 1 hora para access token, 7 d√≠as para refresh token
   - Algoritmo: HS256

6. **Crear AuthController**:
   ```csharp
   [ApiController]
   [Route("api/[controller]")]
   public class AuthController : ControllerBase
   {
       [HttpPost("login")]
       public async Task<ActionResult<LoginResponseDTO>> Login([FromBody] LoginRequestDTO request)
       
       [HttpPost("register")]
       public async Task<ActionResult<UsuarioDTO>> Register([FromBody] RegisterRequestDTO request)
       
       [HttpPost("refresh")]
       public async Task<ActionResult<LoginResponseDTO>> RefreshToken([FromBody] RefreshTokenRequestDTO request)
       
       [HttpPost("revoke")]
       [Authorize]
       public async Task<IActionResult> RevokeToken()
   }
   ```

7. **Configurar middleware en Program.cs**:
   ```csharp
   // Agregar configuraci√≥n JWT
   builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
       .AddJwtBearer(options => { ... });
   
   // Agregar antes de app.UseAuthorization()
   app.UseAuthentication();
   ```

8. **Proteger endpoints existentes**:
   - Agregar `[Authorize]` a todos los controladores
   - Agregar `[Authorize(Roles = "Admin")]` para operaciones sensibles
   - Permitir acceso an√≥nimo solo a Auth endpoints

9. **Migraci√≥n de datos**:
   - Script para hashear passwords existentes en la BD
   - Migraci√≥n EF Core para cambiar columna `Password` a `PasswordHash`

---

### üü† PRIORIDAD ALTA: Sistema de Alertas

**Requerimientos**:

1. **Crear AlertasController**:
   ```csharp
   [ApiController]
   [Route("api/[controller]")]
   [Authorize]
   public class AlertasController : ControllerBase
   {
       [HttpGet("stock-bajo")]
       public async Task<ActionResult<IEnumerable<AlertaStockDTO>>> GetStockBajo(
           [FromQuery] int? restauranteId = null,
           [FromQuery] int? categoriaId = null)
       
       [HttpGet("caducidad")]
       public async Task<ActionResult<IEnumerable<AlertaCaducidadDTO>>> GetProximosACaducar(
           [FromQuery] int? restauranteId = null,
           [FromQuery] int diasAnticipacion = 7)
   }
   ```

2. **DTOs de alertas**:
   ```csharp
   public class AlertaStockDTO
   {
       public int ProductoId { get; set; }
       public string ProductoNombre { get; set; }
       public int RestauranteId { get; set; }
       public string RestauranteNombre { get; set; }
       public decimal StockActual { get; set; }
       public decimal StockMinimo { get; set; }
       public decimal Deficit { get; set; }
       public string Categoria { get; set; }
       public string Proveedor { get; set; }
   }
   
   public class AlertaCaducidadDTO
   {
       public int StockLocalId { get; set; }
       public int ProductoId { get; set; }
       public string ProductoNombre { get; set; }
       public int RestauranteId { get; set; }
       public string RestauranteNombre { get; set; }
       public string Lote { get; set; }
       public decimal Cantidad { get; set; }
       public DateTime FechaCaducidad { get; set; }
       public int DiasRestantes { get; set; }
       public string Urgencia { get; set; } // Cr√≠tico (<3 d√≠as), Alto (<7 d√≠as), Medio (<15 d√≠as)
   }
   ```

3. **L√≥gica de negocio**:
   - **Stock bajo**: `SUM(StockLocal.Cantidad) < Producto.StockMinimo` agrupado por producto y restaurante
   - **Caducidad**: `StockLocal.FechaCaducidad <= DateTime.UtcNow.AddDays(diasAnticipacion)`
   - Ordenar por urgencia/deficit
   - Incluir informaci√≥n de proveedor para facilitar reorden

---

### üü° PRIORIDAD MEDIA: Dashboard de Reportes

**Requerimientos**:

1. **Crear ReportesController**:
   ```csharp
   [ApiController]
   [Route("api/[controller]")]
   [Authorize]
   public class ReportesController : ControllerBase
   {
       [HttpGet("consumo-productos")]
       public async Task<ActionResult<IEnumerable<ConsumoProductoDTO>>> GetConsumoPorProducto(
           [FromQuery] DateTime fechaInicio,
           [FromQuery] DateTime fechaFin,
           [FromQuery] int? restauranteId = null)
       
       [HttpGet("mermas")]
       public async Task<ActionResult<ReporteMermasDTO>> GetReporteMermas(
           [FromQuery] DateTime fechaInicio,
           [FromQuery] DateTime fechaFin,
           [FromQuery] int? restauranteId = null)
       
       [HttpGet("productos-mas-vendidos")]
       public async Task<ActionResult<IEnumerable<ProductoVentasDTO>>> GetProductosMasVendidos(
           [FromQuery] int top = 10,
           [FromQuery] int? restauranteId = null)
       
       [HttpGet("exportar-csv")]
       public async Task<IActionResult> ExportarCSV(
           [FromQuery] string tipoReporte,
           [FromQuery] DateTime fechaInicio,
           [FromQuery] DateTime fechaFin)
   }
   ```

2. **DTOs de reportes**:
   ```csharp
   public class ConsumoProductoDTO
   {
       public int ProductoId { get; set; }
       public string ProductoNombre { get; set; }
       public decimal CantidadConsumida { get; set; }
       public decimal CostoTotal { get; set; }
       public int NumeroMovimientos { get; set; }
   }
   
   public class ReporteMermasDTO
   {
       public decimal TotalMermas { get; set; }
       public decimal CostoTotalMermas { get; set; }
       public List<MermaPorTipoDTO> MermasPorTipo { get; set; }
       public List<MermaPorProductoDTO> ProductosConMasMermas { get; set; }
   }
   ```

3. **L√≥gica de agregaci√≥n**:
   - Usar LINQ para agrupar MovimientoInventario por producto/per√≠odo
   - Filtrar por tipo de movimiento (Salida, Merma)
   - Calcular totales y promedios
   - Ordenar por relevancia

4. **Exportaci√≥n CSV**:
   - Instalar `CsvHelper` NuGet package
   - Generar CSV din√°micamente seg√∫n tipo de reporte
   - Retornar como `FileContentResult`

---

### üîµ PRIORIDAD MEDIA: Migraci√≥n a MongoDB

**Estrategia recomendada**: Migraci√≥n completa (no h√≠brida)

**Pasos**:

1. **Instalar paquetes**:
   ```bash
   dotnet add package MongoDB.Driver
   dotnet add package MongoDB.Bson
   ```

2. **Configurar conexi√≥n**:
   ```json
   // appsettings.json
   {
     "MongoDB": {
       "ConnectionString": "mongodb+srv://username:password@cluster.mongodb.net/",
       "DatabaseName": "freshstock"
     }
   }
   ```

3. **Crear modelos MongoDB**:
   ```csharp
   // Convertir entidades existentes
   public class Producto
   {
       [BsonId]
       [BsonRepresentation(BsonType.ObjectId)]
       public string Id { get; set; }
       
       [BsonElement("proveedorId")]
       public string ProveedorId { get; set; }
       
       [BsonElement("categoriaId")]
       public string CategoriaId { get; set; }
       
       [BsonElement("nombre")]
       public string Nombre { get; set; }
       
       // ... resto de propiedades
       
       [BsonElement("activo")]
       public bool Activo { get; set; } = true;
       
       [BsonElement("fechaCreacion")]
       public DateTime FechaCreacion { get; set; } = DateTime.UtcNow;
   }
   ```

4. **Crear repositorio gen√©rico**:
   ```csharp
   public interface IMongoRepository<T> where T : class
   {
       Task<T> GetByIdAsync(string id);
       Task<IEnumerable<T>> GetAllAsync();
       Task<IEnumerable<T>> FindAsync(Expression<Func<T, bool>> filter);
       Task<T> CreateAsync(T entity);
       Task<bool> UpdateAsync(string id, T entity);
       Task<bool> DeleteAsync(string id);
   }
   
   public class MongoRepository<T> : IMongoRepository<T> where T : class
   {
       private readonly IMongoCollection<T> _collection;
       
       public MongoRepository(IMongoDatabase database, string collectionName)
       {
           _collection = database.GetCollection<T>(collectionName);
       }
       // Implementaci√≥n...
   }
   ```

5. **Adaptar servicios**:
   - Reemplazar `_context.Productos` por `_productoRepository`
   - Cambiar LINQ to Entities por LINQ to MongoDB
   - Adaptar transacciones (usar sesiones de MongoDB)

6. **Script de migraci√≥n de datos**:
   ```csharp
   public class DataMigrationService
   {
       public async Task MigrateFromPostgresToMongoAsync()
       {
           // 1. Exportar de PostgreSQL
           var restaurantes = await _pgContext.Restaurantes.ToListAsync();
           
           // 2. Transformar IDs (int ‚Üí ObjectId)
           var restaurantesMongo = restaurantes.Select(r => new RestauranteMongo
           {
               Id = ObjectId.GenerateNewId().ToString(),
               Nombre = r.Nombre,
               // ...
           });
           
           // 3. Importar a MongoDB
           await _mongoDb.GetCollection<RestauranteMongo>("restaurantes")
               .InsertManyAsync(restaurantesMongo);
           
           // 4. Repetir para todas las colecciones
           // 5. Actualizar referencias (FKs)
       }
   }
   ```

7. **Optimizaciones MongoDB**:
   ```csharp
   // Crear √≠ndices
   await _collection.Indexes.CreateOneAsync(
       new CreateIndexModel<Producto>(
           Builders<Producto>.IndexKeys.Ascending(p => p.Nombre)
       )
   );
   
   // √çndice compuesto para StockLocal
   await _stockCollection.Indexes.CreateOneAsync(
       new CreateIndexModel<StockLocal>(
           Builders<StockLocal>.IndexKeys
               .Ascending(s => s.ProductoId)
               .Ascending(s => s.RestauranteId)
               .Ascending(s => s.Lote),
           new CreateIndexOptions { Unique = true }
       )
   );
   ```

8. **Agregaciones para reportes**:
   ```csharp
   // Ejemplo: Consumo por producto
   var pipeline = new[]
   {
       new BsonDocument("$match", new BsonDocument
       {
           { "tipo", "Salida" },
           { "fecha", new BsonDocument
               {
                   { "$gte", fechaInicio },
                   { "$lte", fechaFin }
               }
           }
       }),
       new BsonDocument("$group", new BsonDocument
       {
           { "_id", "$productoId" },
           { "totalCantidad", new BsonDocument("$sum", "$cantidad") },
           { "totalCosto", new BsonDocument("$sum", 
               new BsonDocument("$multiply", new BsonArray { "$cantidad", "$costoUnitario" })
           )}
       })
   };
   
   var resultado = await _movimientosCollection
       .Aggregate<ConsumoAgregado>(pipeline)
       .ToListAsync();
   ```

9. **Testing de migraci√≥n**:
   - Comparar conteos de registros (PostgreSQL vs MongoDB)
   - Validar integridad de referencias
   - Probar todos los endpoints
   - Benchmark de performance

---

## üìù Entregables Esperados

### 1. C√≥digo Completo
- ‚úÖ Todos los archivos nuevos (Controllers, Services, DTOs, Models)
- ‚úÖ Modificaciones a archivos existentes
- ‚úÖ Migraciones de Entity Framework (si aplica)
- ‚úÖ Scripts de migraci√≥n a MongoDB

### 2. Configuraci√≥n
- ‚úÖ Actualizaci√≥n de [Program.cs](file:///c:/Users/lucas/Documents/GitHub/FreshStock/FreshStock.API/Program.cs) con JWT y MongoDB
- ‚úÖ Actualizaci√≥n de [appsettings.json](file:///c:/Users/lucas/Documents/GitHub/FreshStock/FreshStock.API/appsettings.json) con nuevas configuraciones
- ‚úÖ Registro de servicios en DI container

### 3. Documentaci√≥n
- ‚úÖ Actualizaci√≥n del README.md con:
  - Nuevos endpoints de autenticaci√≥n
  - Endpoints de alertas
  - Endpoints de reportes
  - Instrucciones de configuraci√≥n MongoDB
  - Ejemplos de uso con JWT
- ‚úÖ Comentarios en c√≥digo complejo
- ‚úÖ Documentaci√≥n de API (Swagger annotations)

### 4. Testing
- ‚úÖ Plan de testing manual para cada feature
- ‚úÖ Comandos para probar endpoints con curl/Postman
- ‚úÖ Casos de prueba para validar migraci√≥n

---

## üéØ Criterios de √âxito

### Autenticaci√≥n JWT
- [ ] Usuario puede registrarse con password hasheado
- [ ] Usuario puede hacer login y recibir JWT
- [ ] Endpoints protegidos rechazan requests sin token
- [ ] Refresh token funciona correctamente
- [ ] Autorizaci√≥n por roles funciona (Admin, Gerente, Empleado)

### Sistema de Alertas
- [ ] Endpoint de stock bajo retorna productos correctos
- [ ] Endpoint de caducidad retorna lotes pr√≥ximos a vencer
- [ ] Filtros por restaurante/categor√≠a funcionan
- [ ] Datos incluyen informaci√≥n completa para tomar acci√≥n

### Reportes
- [ ] Reporte de consumo muestra datos precisos
- [ ] Reporte de mermas agrupa correctamente por tipo
- [ ] Exportaci√≥n CSV genera archivo v√°lido
- [ ] Performance aceptable (< 2 segundos para reportes mensuales)

### Migraci√≥n MongoDB
- [ ] Todas las entidades migradas sin p√©rdida de datos
- [ ] Todos los endpoints funcionan igual que antes
- [ ] Performance igual o mejor que PostgreSQL
- [ ] √çndices optimizados para queries frecuentes

---

## üì¶ Estructura de Archivos a Crear/Modificar

### Nuevos Archivos

```
FreshStock.API/
‚îú‚îÄ‚îÄ Controllers/
‚îÇ   ‚îú‚îÄ‚îÄ AuthController.cs                    [NUEVO]
‚îÇ   ‚îú‚îÄ‚îÄ AlertasController.cs                 [NUEVO]
‚îÇ   ‚îî‚îÄ‚îÄ ReportesController.cs                [NUEVO]
‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îú‚îÄ‚îÄ AuthService.cs                       [NUEVO]
‚îÇ   ‚îú‚îÄ‚îÄ AlertasService.cs                    [NUEVO]
‚îÇ   ‚îú‚îÄ‚îÄ ReportesService.cs                   [NUEVO]
‚îÇ   ‚îî‚îÄ‚îÄ DataMigrationService.cs              [NUEVO]
‚îú‚îÄ‚îÄ Interfaces/
‚îÇ   ‚îú‚îÄ‚îÄ IAuthService.cs                      [NUEVO]
‚îÇ   ‚îú‚îÄ‚îÄ IAlertasService.cs                   [NUEVO]
‚îÇ   ‚îú‚îÄ‚îÄ IReportesService.cs                  [NUEVO]
‚îÇ   ‚îî‚îÄ‚îÄ IMongoRepository.cs                  [NUEVO]
‚îú‚îÄ‚îÄ DTOs/
‚îÇ   ‚îú‚îÄ‚îÄ Auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginRequestDTO.cs               [NUEVO]
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginResponseDTO.cs              [NUEVO]
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RegisterRequestDTO.cs            [NUEVO]
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RefreshTokenRequestDTO.cs        [NUEVO]
‚îÇ   ‚îú‚îÄ‚îÄ Alertas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AlertaStockDTO.cs                [NUEVO]
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AlertaCaducidadDTO.cs            [NUEVO]
‚îÇ   ‚îî‚îÄ‚îÄ Reportes/
‚îÇ       ‚îú‚îÄ‚îÄ ConsumoProductoDTO.cs            [NUEVO]
‚îÇ       ‚îú‚îÄ‚îÄ ReporteMermasDTO.cs              [NUEVO]
‚îÇ       ‚îî‚îÄ‚îÄ ProductoVentasDTO.cs             [NUEVO]
‚îú‚îÄ‚îÄ Models/                                   [NUEVO - Para MongoDB]
‚îÇ   ‚îú‚îÄ‚îÄ RestauranteMongo.cs
‚îÇ   ‚îú‚îÄ‚îÄ UsuarioMongo.cs
‚îÇ   ‚îú‚îÄ‚îÄ ProductoMongo.cs
‚îÇ   ‚îî‚îÄ‚îÄ ... (resto de modelos)
‚îú‚îÄ‚îÄ Repositories/                             [NUEVO]
‚îÇ   ‚îî‚îÄ‚îÄ MongoRepository.cs
‚îî‚îÄ‚îÄ Migrations/
    ‚îî‚îÄ‚îÄ 20260124_AddRefreshTokenToUsuario.cs [NUEVO]
```

### Archivos a Modificar

```
FreshStock.API/
‚îú‚îÄ‚îÄ Entities/
‚îÇ   ‚îî‚îÄ‚îÄ Usuario.cs                           [MODIFICAR - agregar PasswordHash, RefreshToken]
‚îú‚îÄ‚îÄ Program.cs                                [MODIFICAR - JWT, MongoDB config]
‚îú‚îÄ‚îÄ appsettings.json                          [MODIFICAR - JWT secret, MongoDB connection]
‚îî‚îÄ‚îÄ README.md                                 [MODIFICAR - documentar nuevas features]
```

---

## üöÄ Orden de Implementaci√≥n Sugerido

### Fase 1: Autenticaci√≥n (D√≠as 1-3)
1. Instalar paquetes NuGet
2. Crear DTOs de autenticaci√≥n
3. Modificar entidad Usuario
4. Crear migraci√≥n EF Core
5. Implementar AuthService
6. Crear AuthController
7. Configurar JWT en Program.cs
8. Proteger endpoints existentes
9. Testing de autenticaci√≥n

### Fase 2: Alertas (D√≠as 4-5)
1. Crear DTOs de alertas
2. Implementar AlertasService
3. Crear AlertasController
4. Testing de alertas

### Fase 3: Reportes (D√≠as 6-8)
1. Crear DTOs de reportes
2. Implementar ReportesService
3. Agregar exportaci√≥n CSV
4. Crear ReportesController
5. Testing de reportes

### Fase 4: Migraci√≥n MongoDB (D√≠as 9-12)
1. Configurar MongoDB Atlas/local
2. Crear modelos MongoDB
3. Implementar repositorio gen√©rico
4. Adaptar servicios existentes
5. Crear script de migraci√≥n de datos
6. Ejecutar migraci√≥n
7. Crear √≠ndices optimizados
8. Testing exhaustivo
9. Benchmark de performance

### Fase 5: Documentaci√≥n y Testing Final (D√≠a 13)
1. Actualizar README.md
2. Agregar ejemplos de uso
3. Testing end-to-end
4. Validaci√≥n de criterios de √©xito

---

## üí° Notas Importantes

### Seguridad
- **NUNCA** commitear secrets en [appsettings.json](file:///c:/Users/lucas/Documents/GitHub/FreshStock/FreshStock.API/appsettings.json) (usar User Secrets o variables de entorno)
- JWT Secret debe ser aleatorio y de al menos 256 bits
- Implementar rate limiting para endpoints de autenticaci√≥n
- Validar todos los inputs con Data Annotations

### Performance
- Usar `AsNoTracking()` en queries de solo lectura
- Implementar paginaci√≥n en endpoints que retornan listas grandes
- Cachear resultados de reportes si es posible
- Crear √≠ndices en MongoDB para queries frecuentes

### Compatibilidad
- Mantener estructura de DTOs existente para no romper clientes
- Versionar API si hay cambios breaking (`/api/v1/`, `/api/v2/`)
- Documentar migraciones de datos claramente

### Testing
- Probar con datos reales (al menos 1000 productos, 100 restaurantes)
- Validar edge cases (stock negativo, fechas inv√°lidas, etc.)
- Probar concurrencia (m√∫ltiples usuarios simult√°neos)

---

## üìö Recursos de Referencia

### Documentaci√≥n Oficial
- [ASP.NET Core JWT Authentication](https://learn.microsoft.com/en-us/aspnet/core/security/authentication/jwt-authn)
- [MongoDB .NET Driver](https://www.mongodb.com/docs/drivers/csharp/current/)
- [Entity Framework Core Migrations](https://learn.microsoft.com/en-us/ef/core/managing-schemas/migrations/)

### Librer√≠as Recomendadas
- `BCrypt.Net-Next` - Hashing de passwords
- `CsvHelper` - Exportaci√≥n CSV
- `Swashbuckle.AspNetCore` - Documentaci√≥n Swagger (ya instalado)

---

## ‚úÖ Checklist Final

Antes de considerar el proyecto completo, verificar:

- [ ] Todos los endpoints de autenticaci√≥n funcionan
- [ ] Passwords hasheados en base de datos
- [ ] JWT tokens v√°lidos y seguros
- [ ] Refresh tokens funcionan
- [ ] Autorizaci√≥n por roles implementada
- [ ] Alertas de stock bajo precisas
- [ ] Alertas de caducidad precisas
- [ ] Reportes de consumo correctos
- [ ] Reportes de mermas correctos
- [ ] Exportaci√≥n CSV funcional
- [ ] Migraci√≥n a MongoDB completa
- [ ] Todos los endpoints funcionan con MongoDB
- [ ] √çndices MongoDB optimizados
- [ ] Performance aceptable (< 2s para queries complejas)
- [ ] README.md actualizado
- [ ] Ejemplos de uso documentados
- [ ] Testing manual completado
- [ ] No hay errores en logs

---

**Fecha**: 2026-01-24  
**Proyecto**: FreshStock API  
**Versi√≥n objetivo**: v2.0 (completo)  
**Tiempo estimado**: 10-13 d√≠as de desarrollo
